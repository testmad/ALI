; Script generated by the Inno Setup Script Wizard.
; SEE THE DOCUMENTATION FOR DETAILS ON CREATING INNO SETUP SCRIPT FILES!

#define InstallerTitle "ALI - Another LiteStep Installer"
#define InstallerWindowTitle "ALI"
#define InstallerVersion "0.0.1"
#define InstallerPublisher "testmad"
#define BaseAppName "LiteStep"
#define BaseAppVersion "0.25.0a-13.08.07"
#define BaseAppPublisher "The LSDev Team"
#define BaseAppURL "http://www.LSDev.org/"

[Setup]
; NOTE: The value of AppId uniquely identifies this application.
; Do not use the same AppId value in installers for other applications.
; (To generate a new GUID, click Tools | Generate GUID inside the IDE.)
AppId={{21F723DC-FFB6-4C7F-BF27-892C1A67CF04}
AppName={#BaseAppName}
AppVersion={#BaseAppVersion}
;AppVerName={#MyAppName} {#MyAppVersion}
AppPublisher={#BaseAppPublisher}
AppPublisherURL={#BaseAppURL}
;AppSupportURL={#MyAppURL}
;AppUpdatesURL={#MyAppURL}
DefaultDirName={pf}\{#BaseAppName}
DefaultGroupName={#BaseAppName}
AllowNoIcons=yes
LicenseFile=C:\Users\testmad\Desktop\ALI\LiteStep\license.txt
OutputDir=C:\Users\testmad\Desktop\ALI\bin
OutputBaseFilename=LiteStep_{#BaseAppVersion}_Setup
SetupIconFile=C:\Users\testmad\Desktop\ALI\Installer\ALI_ls.ico
Compression=lzma
SolidCompression=yes
WizardImageFile=C:\Users\testmad\Desktop\ALI\Installer\Untitled-1.bmp
WizardSmallImageFile=C:\Users\testmad\Desktop\ALI\Installer\237_11744584849_1533_n.bmp
UninstallDisplayIcon={app}\ALI\ALI_ls.ico
ChangesAssociations=True

#include <idp.iss>
MinVersion=0,6.0

[Languages]
Name: "english"; MessagesFile: "compiler:Default.isl"

[Icons]
Name: "{group}\{cm:UninstallProgram,{#BaseAppName}}"; Filename: "{uninstallexe}"; IconFilename: "{app}\ALI\ALI_ls.ico"; IconIndex: 0
Name: "{userdesktop}\Shell Switch"; Filename: "{app}\ALI\ShellSwitch\ShellSwitch.exe"; IconFilename: "{app}\ALI\ShellSwitch\ShellSwitch.exe"; IconIndex: 0

[Messages]
SetupAppTitle={#InstallerTitle}
SetupWindowTitle={#InstallerWindowTitle} {#InstallerVersion}

[Dirs]
Name: "{app}\ALI"
Name: "{app}\ALI\ShellSwitch"
Name: "{app}\ALI\EasyEvars"
Name: "{app}\Modules"
Name: "{app}\NetLoadModule"
Name: "{app}\Profiles"
Name: "{app}\Utilities"
Name: "{app}\Profiles\{username}"
Name: "{app}\Profiles\{username}\personal"
Name: "{app}\Profiles\{username}\personal\jkey"
Name: "{app}\Profiles\{username}\personal\lsxcommand"
Name: "{app}\Profiles\{username}\personal\rainlendar"
Name: "{app}\Profiles\{username}\personal\rainlendar\languages"
Name: "{app}\Profiles\{username}\themes"
Name: "{app}\Profiles\{username}\themes\InstDef"

[Files]
Source: "C:\Users\testmad\Desktop\ALI\LiteStep\changes.txt"; DestDir: "{app}"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\LiteStep\hook.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\LiteStep\libpng13.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\LiteStep\license.txt"; DestDir: "{app}"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\LiteStep\litestep.exe"; DestDir: "{app}"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\LiteStep\lsapi.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\LiteStep\manual.txt"; DestDir: "{app}"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\LiteStep\step.rc"; DestDir: "{app}"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\LiteStep\xPaintClass-1.0.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\LiteStep\zlib1.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\NetLoadModule\doc2.css"; DestDir: "{app}\NetLoadModule"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\NetLoadModule\install.txt"; DestDir: "{app}\NetLoadModule"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\NetLoadModule\msvcr71.dll"; DestDir: "{app}\NetLoadModule"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\NetLoadModule\NetLoadModule2.dll"; DestDir: "{app}\NetLoadModule"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\NetLoadModule\NetLoadModule2.html"; DestDir: "{app}\NetLoadModule"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\Utilities\LOEC.lua"; DestDir: "{app}\Utilities"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\Utilities\LOSS.lua"; DestDir: "{app}\Utilities"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\Utilities\lua5.1.dll"; DestDir: "{app}\Utilities"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\Utilities\lua51.dll"; DestDir: "{app}\Utilities"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\Utilities\rcparser.lua"; DestDir: "{app}\Utilities"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\Utilities\SLI-ModuleManager.exe"; DestDir: "{app}\Utilities"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\Utilities\SLI-OnlineModuleList.old"; DestDir: "{app}\Utilities"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\Utilities\SLI-OnlineModuleList.txt"; DestDir: "{app}\Utilities"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\Utilities\SLI-ThemeManager.exe"; DestDir: "{app}\Utilities"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\Utilities\SLI-ThemeManager.txt"; DestDir: "{app}\Utilities"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\Utilities\winreg.dll"; DestDir: "{app}\Utilities"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\Utilities\wxlua.exe"; DestDir: "{app}\Utilities"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\Personal\evars.rc"; DestDir: "{app}\Profiles\{username}\personal"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\Personal\hotkey.rc"; DestDir: "{app}\Profiles\{username}\personal"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\Personal\personal.rc"; DestDir: "{app}\Profiles\{username}\personal"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\Personal\popup.rc"; DestDir: "{app}\Profiles\{username}\personal"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\Personal\jkey\vk104.txt"; DestDir: "{app}\Profiles\{username}\personal\jkey"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\Personal\lsxcommand\engines.list"; DestDir: "{app}\Profiles\{username}\personal\lsxcommand"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\Personal\lsxcommand\history.ini"; DestDir: "{app}\Profiles\{username}\personal\lsxcommand"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\Personal\lsxcommand\old.engines.list"; DestDir: "{app}\Profiles\{username}\personal\lsxcommand"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\Personal\rainlendar\rainlendar.ini"; DestDir: "{app}\Profiles\{username}\personal\rainlendar"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\Personal\rainlendar\languages\English.example"; DestDir: "{app}\Profiles\{username}\personal\rainlendar\languages"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\Personal\rainlendar\languages\French.ini"; DestDir: "{app}\Profiles\{username}\personal\rainlendar\languages"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\Personal\rainlendar\languages\German.ini"; DestDir: "{app}\Profiles\{username}\personal\rainlendar\languages"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\Personal\rainlendar\languages\Russian.ini"; DestDir: "{app}\Profiles\{username}\personal\rainlendar\languages"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\Themes\themeselect.rc"; DestDir: "{app}\Profiles\{username}\themes"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\Themes\themeslist.rc"; DestDir: "{app}\Profiles\{username}\themes"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\Themes\InstDef\theme.rc"; DestDir: "{app}\Profiles\{username}\themes\InstDef"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\FileIcons\gsz.ico"; DestDir: "{app}\FileIcons"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\FileIcons\GSZBox.ico"; DestDir: "{app}\FileIcons"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\FileIcons\GSZBox2.ico"; DestDir: "{app}\FileIcons"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\FileIcons\GSZDoc.ico"; DestDir: "{app}\FileIcons"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\FileIcons\GSZDoc2.ico"; DestDir: "{app}\FileIcons"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\FileIcons\LSBox.ico"; DestDir: "{app}\FileIcons"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\FileIcons\LSDoc.ico"; DestDir: "{app}\FileIcons"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\FileIcons\lsz.ico"; DestDir: "{app}\FileIcons"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\FileIcons\LSZBox.ico"; DestDir: "{app}\FileIcons"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\FileIcons\LSZDoc.ico"; DestDir: "{app}\FileIcons"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\FileIcons\rc.ico"; DestDir: "{app}\FileIcons"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\FileIcons\rc2.ico"; DestDir: "{app}\FileIcons"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\FileIcons\RCBox.ico"; DestDir: "{app}\FileIcons"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\FileIcons\RCDoc.ico"; DestDir: "{app}\FileIcons"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\FileIcons\SetShellExplorer.ico"; DestDir: "{app}\FileIcons"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\FileIcons\SetShellLS.ico"; DestDir: "{app}\FileIcons"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\FileIcons\ALI_ls.ico"; DestDir: "{app}\FileIcons"; Flags: ignoreversion
Source: "C:\Users\testmad\Desktop\ALI\Installer\psvince.dll"; DestDir: "{app}\ALI"; Flags: dontcopy
Source: "C:\Users\testmad\Desktop\ALI\ShellSwitch\ShellSwitch.exe"; DestDir: "{app}\ALI\ShellSwitch"; Flags: ignoreversion

[Registry]
Root: "HKLM"; Subkey: "Software\LOSI"; ValueType: none; Flags: uninsdeletekey
Root: "HKLM"; Subkey: "Software\LOSI\Installer"; ValueType: string; ValueName: "LitestepDir"; ValueData: "{app}"; Flags: uninsdeletekeyifempty uninsdeletevalue
Root: "HKLM"; Subkey: "Software\LOSI\Installer"; ValueType: string; ValueName: "LitestepArch"; ValueData: "32bit"; Flags: uninsdeletekeyifempty uninsdeletevalue
Root: "HKCU"; Subkey: "Software\Litestep"; ValueType: none; Flags: uninsdeletekey
Root: "HKCU"; Subkey: "Software\Litestep\SLI"; ValueType: none; Flags: uninsdeletekey
Root: "HKCU"; Subkey: "Software\Litestep\SLI\ModuleManager"; ValueType: none; Flags: uninsdeletekey
Root: "HKCU"; Subkey: "Software\Litestep\SLI\ModuleManager"; ValueType: string; ValueName: "Site1"; ValueData: "LS-Universe#;#http://www.modules.ls-universe.info/modules"; Flags: uninsdeletevalue
Root: "HKCU"; Subkey: "Software\Litestep\SLI\ModuleManager"; ValueType: string; ValueName: "Site2"; ValueData: "NBI-Studio#;#http://www.modules.nbi-studio.com"; Flags: uninsdeletevalue
Root: "HKCU"; Subkey: "Software\Litestep\SLI\ModuleManager"; ValueType: string; ValueName: "Site3"; ValueData: "ShellFront#;#http://www.modules.shellfront.org"; Flags: uninsdeletevalue
Root: "HKCU"; Subkey: "Software\Litestep\SLI\ThemeManager"; ValueType: none; Flags: uninsdeletekey
Root: "HKCU"; Subkey: "Software\Litestep\SLI\ThemeManager"; ValueType: string; ValueName: "LitestepDir"; ValueData: "{app}\"; Flags: uninsdeletevalue
Root: "HKCU"; Subkey: "Software\Litestep\SLI\ThemeManager"; ValueType: dword; ValueName: "SecurityTimeout"; ValueData: "2"; Flags: uninsdeletevalue
Root: "HKCU"; Subkey: "Software\Litestep\SLI\ThemeManager"; ValueType: string; ValueName: "ThemesDir"; ValueData: "{app}\Profiles\{username}\themes\"; Flags: uninsdeletevalue
Root: "HKLM"; Subkey: "Software\Microsoft\Windows NT\CurrentVersion\Winlogon"; ValueType: dword; ValueName: "AutoRestartShell"; ValueData: "1"; Flags: uninsdeletevalue

[Code]
  function IsModuleLoaded(modulename: AnsiString): Boolean;
  external 'IsModuleLoaded@files:psvince.dll stdcall';

function InitializeSetup(): Boolean;
begin

  // check if litestep is running
  if IsModuleLoaded( 'litestep.exe' ) then
  begin
    MsgBox( 'LiteStep is currently running.' + #13#13 + 'Please switch your shell to Explorer.exe.',
             mbError, MB_OK );
    Result := false;
  end
  else Result := true;
end;

var
  VCwarnPage: TOutputMsgWizardPage;

procedure InitializeWizard;
begin



  VCwarnPage:=CreateOutputMsgPage(wpWelcome,
  'LiteStep Requirements', 'Please read the following important information before continuing.',
  'LiteStep requires the following files:' + #13#13#13#13 + '          Microsoft Visual C++ 2005 Runtimes' + #13 + '          Microsoft Visual C++ 2005 SP1 Runtimes' + #13 + '          Microsoft Visual C++ 2010 SP1 Runtimes' + #13 + '          Micorsoft Visual C++ 2012 Runtimes' + #13 + '          Microsoft Visual C++ 2013 Runtimes' + #13#13#13#13 + 'They will be downloaded and installed automatically.');

//  idpAddFile('http://download.microsoft.com/download/d/3/4/d342efa6-3266-4157-a2ec-5174867be706/vcredist_x86.exe', ExpandConstant('{tmp}\vcredist_2005_x86.exe'));
//  idpAddFile('http://download.microsoft.com/download/e/1/c/e1c773de-73ba-494a-a5ba-f24906ecf088/vcredist_x86.exe', ExpandConstant('{tmp}\vcredist_2005sp1_x86.exe'));

//  idpAddFile('http://download.microsoft.com/download/1/1/1/1116b75a-9ec3-481a-a3c8-1777b5381140/vcredist_x86.exe', ExpandConstant('{tmp}\vcredist_2008_x86.exe'));
//  idpAddFile('http://download.microsoft.com/download/d/d/9/dd9a82d0-52ef-40db-8dab-795376989c03/vcredist_x86.exe', ExpandConstant('{tmp}\vcredist_2008sp1_x86.exe'));
  
//  idpAddFile('http://download.microsoft.com/download/1/6/5/165255E7-1014-4D0A-B094-B6A430A6BFFC/vcredist_x86.exe', ExpandConstant('{tmp}\vcredist_2010sp1_x86.exe'));
//  idpAddFile('http://download.microsoft.com/download/1/6/B/16B06F60-3B20-4FF2-B699-5E9B7962F9AE/VSU4/vcredist_x86.exe', ExpandConstant('{tmp}\vcredist_2012_x86.exe'));
//  idpAddFile('http://download.microsoft.com/download/2/E/6/2E61CFA4-993B-4DD4-91DA-3737CD5CD6E3/vcredist_x86.exe', ExpandConstant('{tmp}\vcredist_2013_x86.exe'));
//  idpSetOption('AllowContinue',  '0');
//  idpSetOption('DetailsVisible', '1');
//  idpSetOption('DetailsButton',  '0');
//  idpSetOption('RetryButton',    '1');
//  idpDownloadAfter(wpReady);

end;

[Run]
;Filename: "{tmp}\vcredist_2005_x86.exe"; Parameters: "/q:a /c:""VCREDI~1.EXE /q:a /c:""""msiexec /i vcredist.msi /qn"""" """; Flags: runascurrentuser waituntilterminated; StatusMsg: "Installing Microsoft Visual C++ 2005 Runtimes..."
;Filename: "{tmp}\vcredist_2005sp1_x86.exe"; Parameters: "/q:a /c:""VCREDI~3.EXE /q:a /c:""""msiexec /i vcredist.msi /qn"""" """; Flags: runascurrentuser waituntilterminated; StatusMsg: "Installing Microsoft Visual C++ 2005 SP1 Runtimes..."

;Filename: "{tmp}\vcredist_2008_x86.exe"; Parameters: "/q"; Flags: runascurrentuser waituntilterminated; StatusMsg: "Installing Microsoft Visual C++ 2008 Runtimes..."
;Filename: "{tmp}\vcredist_2008sp1_x86.exe"; Parameters: "/q"; Flags: runascurrentuser waituntilterminated; StatusMsg: "Installing Microsoft Visual C++ 2008 SP1 Runtimes..."

;Filename: "{tmp}\vcredist_2010sp1_x86.exe"; Parameters: "/q"; Flags: runascurrentuser waituntilterminated; StatusMsg: "Installing Microsoft Visual C++ 2010 SP1 Runtimes..."
;Filename: "{tmp}\vcredist_2012_x86.exe"; Parameters: "/q"; Flags: runascurrentuser waituntilterminated; StatusMsg: "Installing Microsoft Visual C++ 2012 Runtimes..."
;Filename: "{tmp}\vcredist_2013_x86.exe"; Parameters: "/q"; Flags: runascurrentuser waituntilterminated; StatusMsg: "Installing Microsoft Visual C++ 2013 Runtimes..."

Filename: "{app}\changes.txt"; Flags: postinstall shellexec skipifsilent; Description: "View readme.txt"
Filename: "{app}\ALI\ShellSwitch\ShellSwitch.exe"; Flags: postinstall skipifsilent runascurrentuser; Description: "Set LiteStep as Shell."
